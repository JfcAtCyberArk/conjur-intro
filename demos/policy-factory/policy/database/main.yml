---
- !policy instances
- !policy-factory
  id: instance
  base: !policy instances
  annotations:
    ui/input/param/name: string
    ui/input/context/hostname: string
    ui/input/context/port: string
    ui/input/context/username: string
    ui/input/context/password: password
  template: |
    - !policy
      id: <%=params[:name]%>
      body:
        # Secret Declarations
        - &secrets
          - !variable
            id: hostname
            annotations:
              provision/provisioner: context
              provision/context/parameter: hostname
          - !variable
            id: port
            annotations:
              provision/provisioner: context
              provision/context/parameter: port
          - !variable
            id: username
            annotations:
              provision/provisioner: context
              provision/context/parameter: username
          - !variable
            id: password
            annotations:
              provision/provisioner: context
              provision/context/parameter: password
        
        # User & Manager Groups
        - !group secrets-users
        - !group secrets-managers
        - !permit
          role: !group secrets-users
          privileges: [ read, execute ]
          resources: *secrets
        - !permit
          role: !group secrets-managers
          privileges: [ read, execute, update ]
          resources: *secrets

- !group managers
- !permit
  role: !group managers
  resource: !policy-factory instance
  privileges: [ read, execute ]
